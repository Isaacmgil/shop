@if (productResource.isLoading()) {
<div class="flex justify-center items-center h-screen">
  <span class="loading loading-spinner loading-lg"></span>
</div>
}

@if (productResource.hasValue()) {
<div class="grid grid-cols-1 sm:grid-cols-2 gap-4">

  <product-carousel [images]="productResource.value().images" />

  <div class="mt-5">
    <h2 class="text-2xl font-bold font-montserrat">
      {{productResource.value().title}}
    </h2>
    <div class="divider"></div>
    <p>
      {{productResource.value().description}}
    </p>

    <div class="flex gap-3 mt-5">
      <p class="text-3xl font-extrabold text-secondary">
        ${{ productResource.value().price }}
      </p>

      <div class="flex items-center text-primary">
        <span class="text-sm font-medium">Stock: {{ productResource.value().stock }}</span>
      </div>
    </div>

    <div class="mt-5">
      <h3 class="text-lg font-bold">Select Size:</h3>
      <div class="flex flex-wrap gap-2 mt-2">
        @for (size of productResource.value().sizes; track size) {
        <button class="btn btn-secondary" [class.btn-secondary]="selectedSize() === size" (click)="onSelectSize(size)">
          {{ size }}
        </button>
        }
      </div>
    </div>

    <div>
      <button class="btn flex btn-secondary mt-5 w-3xl" (click)="onToggleFavorite()">
        Add to Favorites
        <svg
          width="25px"
          height="25px"
          viewBox="0 0 24 24"
          xmlns="http://www.w3.org/2000/svg"
          [attr.fill]="isFavorite() ? '#ef4444' : 'none'"
          [attr.stroke]="isFavorite() ? 'none' : '#ffffff'"
        >
          <g id="SVGRepo_bgCarrier" stroke-width="0"></g>
          <g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g>
          <g id="SVGRepo_iconCarrier">
            <path d="M2 9.1371C2 14 6.01943 16.5914 8.96173 18.9109C10 19.7294 11 20.5 12 20.5C13 20.5 14 19.7294 15.0383 18.9109C17.9806 16.5914 22 14 22 9.1371C22 4.27416 16.4998 0.825464 12 5.50063C7.50016 0.825464 2 4.27416 2 9.1371Z"></path>
          </g>
        </svg>
      </button>
    </div>

    <div class="fixed bottom-8 right-8 z-50">
      <div class="relative group">
        <button class="btn btn-secondary btn-circle shadow-lg hover:bg-red-800" (click)="toggleFavoritesPopup()">
          <svg width="25px" height="25px" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"
            stroke="#ffffff">
            <g id="SVGRepo_bgCarrier" stroke-width="0"></g>
            <g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g>
            <g id="SVGRepo_iconCarrier">
              <path
                d="M2 9.1371C2 14 6.01943 16.5914 8.96173 18.9109C10 19.7294 11 20.5 12 20.5C13 20.5 14 19.7294 15.0383 18.9109C17.9806 16.5914 22 14 22 9.1371C22 4.27416 16.4998 0.825464 12 5.50063C7.50016 0.825464 2 4.27416 2 9.1371Z"
                fill="#fff4e5"></path>
            </g>
          </svg>
        </button>

        @if (favoritesCount() > 0) {
        <span
          class="absolute top-0 right-0 inline-flex items-center justify-center px-2 py-1 text-xs font-bold leading-none text-red-100 bg-red-600 rounded-full transform translate-x-1/2 -translate-y-1/2">
          {{ favoritesCount() }}
        </span>
        }

        @if (showFavoritesPopup()) {
        <div
          class="absolute bottom-16 right-0 w-80 bg-base-100 rounded-box shadow-2xl p-4 transform transition-all duration-300 ease-in-out origin-bottom-right">
          <h4 class="text-lg font-bold mb-4">My Favorites</h4>
          @if (productService.favorites().length === 0) {
          <p class="text-gray-500">You still don't have favorite products yet!</p>
          } @else {
          <div class="flex flex-col gap-2 max-h-64 overflow-y-auto">
            @for (fav of productService.favorites(); track fav.id) {
            <a [routerLink]="['/product/', fav.id]"
              class="flex items-center gap-3 p-2 rounded-lg hover:bg-base-200 transition-colors">
              <img [src]="fav.images[0] | productImage" [alt]="fav.title" class="w-12 h-12 object-cover rounded-md">
              <span class="truncate">{{ fav.title }}</span>
            </a>
            }
          </div>
          }
        </div>
        }
      </div>
    </div>


  </div>
</div>
}
